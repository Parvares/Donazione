<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donazione alla Biblioteca Elsa Morante</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-style/dist/xlsx.full.min.js"></script>
    <style>
        /* Stili precedenti */
    </style>
</head>
<body>
    <div class="container">
        <h1>Donazione alla Biblioteca Elsa Morante</h1>
        
        <div class="info-box">
            Compila il modulo per donare i tuoi libri alla biblioteca. Tutti i campi contrassegnati con * sono obbligatori.
        </div>

        <form id="donationForm">
            <h3>Dati Personali</h3>
            <div class="form-group">
                <label for="nome">Nome: *</label>
                <input type="text" id="nome" name="nome" required>
            </div>
            
            <div class="form-group">
                <label for="cognome">Cognome: *</label>
                <input type="text" id="cognome" name="cognome" required>
            </div>
            
            <div class="form-group">
                <label for="tessera">Numero Tessera:</label>
                <input type="text" id="tessera" name="tessera">
            </div>

            <div class="form-group">
                <label for="telefono">Telefono:</label>
                <input type="tel" id="telefono" name="telefono">
            </div>
            
            <div class="form-group">
                <label for="email">Email: *</label>
                <input type="email" id="email" name="email" required>
            </div>

            <h3>Libri da donare</h3>
            <div id="bookList"></div>
            
            <div class="consent-box">
                <label>
                    <input type="checkbox" id="accept" name="accept" required>
                    Ho letto e accetto i <a href="https://www.bibliotechediroma.it/sebina/repository/opac/images/Elsa_Morante/TERMINI%20E%20CONDIZIONI.pdf" target="_blank">termini e condizioni</a>
                </label>
            </div>
            
            <button type="submit">Accetta e Genera il Documento</button>
        </form>
    </div>

    <script>
        let bookCount = 0;

        function createBookEntry() {
            const bookDiv = document.createElement('div');
            bookDiv.className = 'book-entry';
            bookCount++;
            bookDiv.innerHTML = `
                <div class="book-counter">${bookCount}</div>
                <div class="form-group">
                    <label>Titolo: *</label>
                    <input type="text" class="book-title" required>
                </div>
                <div class="form-group">
                    <label>Autore:</label>
                    <input type="text" class="book-author">
                </div>
                <div class="form-group">
                    <label>Editore:</label>
                    <input type="text" class="book-publisher">
                </div>
                <div class="form-group">
                    <label>Anno:</label>
                    <input type="text" class="book-year">
                </div>
                <div class="form-group">
                    <label>ISBN:</label>
                    <input type="text" class="book-isbn">
                </div>
                <button type="button" class="remove-book" onclick="removeBook(this)">Rimuovi</button>
                <button type="button" class="add-book" onclick="createBookEntry()">+ Aggiungi Libro</button>
            `;
            document.getElementById('bookList').appendChild(bookDiv);
            updateBookCount();
        }

        function removeBook(button) {
            button.closest('.book-entry').remove();
            updateBookCount();
        }

        function updateBookCount() {
            const counters = document.querySelectorAll('.book-counter');
            counters.forEach((counter, index) => {
                counter.textContent = index + 1;
            });
            bookCount = counters.length;
        }

        document.getElementById('donationForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Evita il comportamento predefinito del form

            const books = [];
            const bookEntries = document.querySelectorAll('.book-entry');
            bookEntries.forEach(entry => {
                const title = entry.querySelector('.book-title').value;
                const author = entry.querySelector('.book-author').value;
                const publisher = entry.querySelector('.book-publisher').value;
                const year = entry.querySelector('.book-year').value;
                const isbn = entry.querySelector('.book-isbn').value;
                books.push([title, author, publisher, year, isbn]);
            });

            // Prepara i dati per il file Excel
            const ws = XLSX.utils.aoa_to_sheet([
                ['Nome', 'Cognome', 'Tessera', 'Telefono', 'Email'],
                [document.getElementById('nome').value, document.getElementById('cognome').value, document.getElementById('tessera').value, document.getElementById('telefono').value, document.getElementById('email').value],
                [],
                ['Titolo', 'Autore', 'Editore', 'Anno', 'ISBN'],
                ...books
            ]);

            // Applica il grassetto alle intestazioni
            ['A1', 'B1', 'C1', 'D1', 'E1'].forEach(cell => {
                ws[cell].s = { font: { bold: true } };
            });
            ['A2', 'B2', 'C2', 'D2', 'E2'].forEach(cell => {
                ws[cell].s = { font: { bold: true } };
            });

            // Crea e scarica il file Excel
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Donazione");
            XLSX.writeFile(wb, 'donazione_biblioteca.xlsx');
        });

        // Aggiungi il primo libro al caricamento della pagina
        createBookEntry();
    </script>
</body>
</html>
